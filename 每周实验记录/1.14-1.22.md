##### 1.14
下载git仓库：MacOS系统自带git，终端输入`git --version`可查看版本，输入`git help`可查询git的各种语句。
解决了本地仓库混乱的问题：终端中输入`ls Downloads/python -ha`可展示.xx开头的系统隐藏文件，删除隐藏的`.git`文件即可把该文件夹从git的仓库移除。
固定了双清大厦电脑的IP地址，并实现了端口转发。从另外的电脑通过`ssh -p 6666 jianyingzhu@124.65.131.150`访问iMac（6666为端口转发设置的个人专属节点）。
了解到内网IP和外部访问IP不同，从外部访问只有一个IP地址，每个人有一个专属的节点，通过外部IP连到不同的节点时转发到不同的电脑/内部IP（表述可能不准确）。
下载了arcanist、libphutil插件，安装在`～/opt`下，`cd ～/opt`后`git clone https://github.com/phacility/arcanist.git` 以及`git clone https://github.com/phacility/libphutil.git`即可。iMac在安装arcanist时出了bug，原因是修改的`.bashrc`中的环境变量PATH不加载。修改了`.bashrc`, `.bash_profile`后发现没用，最后发现和`.zprofile`有关，应该是下载python时python做的好事。（调试时，在终端中输入`echo $PATH`查看当前当前系统PATH路径）  
设置了iTerm2的记住gpu账号、密码的脚本，在profile中点击gpu00即可登陆gpu00，点击default则登陆local host（相当于本地的终端）。
vscode的仓库管理较为方便，不过新建分支时总是有bug。若vscode建立分支时不显示，处理方法：终端`git branch dev`（新建一个叫做dev的分支），`git branch`（查看所有分支信息），`git checkout dev`（切换到dev分支），此时打开vscode就有dev分支并且已经切换到dev了。(以上三个语句可以合并为`git checkout -b dev`，代表在当前分支下新建一个分支`dev`)
分支管理中保持master和云端同步，每次新建分支。

#### 1.15
本地新建dev分支，修改代码，`git add`，`git commit`(这两步可以用vscode做)，`arc diff`，`accept`之后`arc land`。  
control+u删除terminal光标前的整行。pwd查看当前目录的路径。cd ..返回上一层目录。  
下载arc时又报和昨天一样的错误：error: RPC failed; curl 18 transfer closed with outstanding read data remaining
fatal: The remote end hung up unexpectedly。原因是网又慢又卡，解决办法是给终端挂上代理，详情见[该网页](https://kerminate.me/2018/10/22/mac-%E7%BB%88%E7%AB%AF%E5%AE%9E%E7%8E%B0%E7%BF%BB%E5%A2%99/)。使用一次(只给当前打开的终端挂上一次代理)，在终端输入  
`export http_proxy=http://127.0.0.1:1087 `
以及`export https_proxy=http://127.0.0.1:1087`
（其中1087替换为自己翻墙节点的http port，在TrojanQT5中为settings---inbound settings（入站设置）---Http Port）。
iTerm2中无SFTP/FTP文件传输协议，使用`rsync -arvP gpu00:~/zhujianying/super_resolution/src/models.py`语句下载文件，倒过来即为上传（一个为target一个为source）
待完成：跑通那个带一定错误率的reconstruct，然后提交一个diff上去审核。test/zq_test_1 的reconstruct已经没了。要么是test/test_adam.py，是名旭写的，要么是test/zhangqi/test_1.py，是张起用的，随便拿一个，在这基础上改，先跑出一个结果。张起的里面没有加cross validation和learning rate schedule，加也不困难。（已完成）
张起给的丢掉坏颗粒思路：loss从batch的和改成batch最小的一半/一部分，在sum和最小的一半中找一个soft一些的版本。

#### 1.18
.mrc用chimera看结果时，加gaussian滤波接近于低通滤波，可以调整带宽width，带宽越大滤波越狠，越能看到更加清晰的样子。下面的图片为上面的图片经过滤波的样子。
加gaussian滤波的方法：Tools-Volume Filter-Filter Type选择Gaussian-调整width-点击Filter，呈现的两幅图下为上的滤波结果，可以点击step调整效果，一般想要看到直接结果step设置为1。step右侧的圈圈中间画个点的为“现实结果中隐藏这幅图”。
cv error往往有先减小再增大的趋势，一直在轻微增大说明调参有问题。
.py文件中的parse把python3 -xxx后面的参数传进py文件。
程序reconstruct跑出来的结果A、B是cross validation的两部分的结果。

#### 1.19
1.19下午讨论：
动态：cryo-SPARC（输入：原始数据）。我们的输入：第一帧和最后一帧。
task 1、复现movie（cryo-SPARC的错误结果）。cryo-SPARC v3.0。（张起）
task 2、NCP-1 two conformation-->intermediate state。
问题：
1. sub unit突然出现？
2. 加入约束：刚体/近处的点不能压缩的太狠，远处的点距离可变/保距。

关于bad particle picking：
1. 分别计算ground truth往真实方向与错误（某一随机) 方向投影的loss, 比较两者差距。 
2. 若两者差距大，则有多种做法：原来的方法是梯度下降时计算batch中梯度的均值，即：原损失函数为$\frac{1}{N} \sum_{A_{i}, b_{i} \in Batch} \left|A_{i} x-b_{i}\right|_{2}^{2}$，其中$N$为batch中数据点的个数，可修改为$\operatorname{median}_{A i, b i \in B a t c h}\left|A_{i} x-b_{i}\right|_{2}^{2}$，也可修改为loss较小的50%的数据的梯度的均值。（一个问题：错误数据的比例未知）
3. 若肉眼观察真实方向与错误方向投影的loss两者差距大，也可做假设检验：原假设为“正确数据与错误数据loss相差较大”，比较显著性。  

Compressed_Sensing->src_>kernel中的函数用cupy写，更为底层，部署到gpu。
mrc.data为大型矩阵。`convert.order`的True/False为fft第一个元素为中心还是中心为中心，由fft与rfft造成。mrc中可以存image、colume、module等等。python中`\`表下一行接在这一行这个位置。
一个model往很多方向投影，比较用正确方向的$A_{i}$和对应的$b_{i}$计算的loss$\frac{1}{N} \sum_{A_{i}, b_{i} \in \text { Batch }}\left|A_{i} x-b_{i}\right|_{2}^{2}$（准确的说是cv error的形式）和用随机的方向的$A_{i}$和$b_{i}$计算的loss。x为ground truth的model。（此举为了判断是噪声贡献的多还是正确重构贡献的多）
$A_{i}$需要为投影，卷ctf，平移的复合蒜子。 
.thu文件的每一行是一个image，每个image按列拼接在一起，1K的.thu有1000列。

##### 1.20
$\frac{1}{N} \sum_{A_{i}, b_{i} \in \text { Batch }}\left|A_{i} x-b_{i}\right|_{2}^{2}$
loss 1: b_{i}为真实的image, A_{i}为b_{i}对应的算子, x为ground truth的model。
loss 2: b_{i}为image, A_{i}为旋转四元数为随机的算子, x为ground truth的model。
Meta1K怎么看（用cat在terminal里很乱）？答：下载下来用vscode看。
`mrc open`时`permissive=True`为了防止检查mrc的header文件是否合规时报不合规直接停止运行。
如何把`.map, .mrc`格式的文件转为矩阵形式？（mrc.open干的也是这个事）
```python
with mrcfile.mmap(self.stack_names[i], permissive = True, mode = 'r') as mrc:
            img = torch.from_numpy(mrc.data[self.image_ids[i]]).type(torch.float64)
```
loss函数里的trans指translation。

##### 1.21
`royal tsx-file transfer-properties-advaced-local`可以更改进入以后的目录。
`git add——>git commit——>arc diff --update D365`
若进入GNU nano则`control+X`退出就可
合并本地master与dev：`git checkout master-git pull`(若有冲突则手动调)->`git checkout dev`->`git merge master`（还要加注解）。
组会：输出结果需要画图，充分可视化。
一个问题：loss低不代表是good particle，可能是$A_{i}$和$b_{i}$都是错的，`test_adam`的结果只告诉我们$A_{i}$和$b_{i}$的旋转不匹配那么loss一定差距显著。

##### 1.22
Royal tsx中可以设置与双清电脑的terminal登陆和SFTP：原先`ssh -p 6666 jianyingzhu@124.65.131.150`访问iMac，`jianyingzhu`为用户名，输入在credential里，密码为电脑登陆密码，Port就是端口转发的port（6666）。
`pip3 install xxx`是输入在terminal里的而不是.py文件里（这点与R语言的记混了）
`Dataset.py`中float(info[0]-编号到21)，编号是`.thu`文件中对应的列，负号的出现是因为四元数的共轭。
昨日组会布置的任务（两周内完成，并报告）：
1. 两篇论文：
reweighted least square paper
sorted l1 norm paper
2. demo程序推广到：
translation error significant or not
3. 新编写程序：
change loss（sorted l1） and gradient error estimation（错误率估计：Dataset.py中设定错误颗粒是生成一个random数，若他大于给定错误率，则随机四元数。用bool数（0，1）设定一个flag，记录下它正确与否，看看在loss中哪些颗粒被使用了）

markdown转pdf较方便的方法：安装Markdown Preview Enhance-保存.md-预览界面右键选择“Open in Browser”-在浏览器中打开后按control+P(打印)-“目标打印机”设置为“另存为PDF”-打开“更多设置”，取消“页眉与页脚”（不然会出现文件路径）-保存











